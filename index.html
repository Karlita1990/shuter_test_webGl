<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>3D –ë—Ä–æ–¥–∏–ª–∫–∞-—Å—Ç—Ä—ñ–ª—è–ª–∫–∞ (–ú–æ–±—ñ–ª—å–Ω–∞, –ø—Ä–æ—Å—Ç–∞ –≤–µ—Ä—Å—ñ—è)</title>
    <style>
        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            background: #000;
            touch-action: none;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        
        /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞ –æ—Ä—ñ—î–Ω—Ç–∞—Ü—ñ—è */
        @media (orientation: portrait) {
            #rotate-warning {
                display: flex !important;
            }
        }
        
        #rotate-warning {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            color: white;
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            font-size: 24px;
            text-align: center;
            padding: 20px;
        }
        
        #info-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 10px;
            border: 2px solid #00ff00;
            z-index: 10;
            display: flex;
            justify-content: space-around;
            backdrop-filter: blur(5px);
            font-size: 16px;
        }
        
        #info-panel div {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        #info-panel .value {
            color: #00ff00;
            font-weight: bold;
            font-size: 18px;
        }
        
        #crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border: 2px solid rgba(255,255,255,0.8);
            border-radius: 50%;
            z-index: 5;
            pointer-events: none;
        }
        
        #crosshair::before, #crosshair::after {
            content: '';
            position: absolute;
            background: rgba(255,255,255,0.8);
        }
        
        #crosshair::before {
            width: 20px;
            height: 2px;
            top: 19px;
            left: 10px;
        }
        
        #crosshair::after {
            width: 2px;
            height: 20px;
            top: 10px;
            left: 19px;
        }
        
        #level-name {
            position: absolute;
            top: 70px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.6);
            color: #ffaa00;
            padding: 8px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            border: 1px solid #ffaa00;
            z-index: 10;
            text-align: center;
            backdrop-filter: blur(5px);
        }
        
        /* –°–ø—Ä–æ—â–µ–Ω–µ —Å–µ–Ω—Å–æ—Ä–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è */
        #touch-zone-left {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 150px;
            height: 150px;
            background: rgba(255,255,255,0.15);
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 75px;
            z-index: 20;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            text-transform: uppercase;
            touch-action: none;
        }
        
        #touch-zone-right {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 150px;
            height: 150px;
            background: rgba(255,255,255,0.15);
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 75px;
            z-index: 20;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            text-transform: uppercase;
            touch-action: none;
        }
        
        #fire-button {
            position: absolute;
            bottom: 190px;
            right: 40px;
            width: 80px;
            height: 80px;
            background: rgba(255,0,0,0.6);
            border: 4px solid #ff0000;
            border-radius: 40px;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 20px rgba(255,0,0,0.5);
            touch-action: none;
        }
        
        #interact-button {
            position: absolute;
            bottom: 190px;
            left: 40px;
            width: 80px;
            height: 80px;
            background: rgba(0,255,0,0.4);
            border: 4px solid #00ff00;
            border-radius: 40px;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 20px rgba(0,255,0,0.3);
            touch-action: none;
        }
        
        #joystick-left, #joystick-right {
            position: absolute;
            width: 150px;
            height: 150px;
            z-index: 21;
            pointer-events: none;
        }
        
        #joystick-left {
            bottom: 20px;
            left: 20px;
        }
        
        #joystick-right {
            bottom: 20px;
            right: 20px;
        }
        
        .joystick-knob {
            position: absolute;
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.6);
            border-radius: 30px;
            top: 45px;
            left: 45px;
            border: 3px solid white;
            transition: transform 0.05s;
            pointer-events: none;
        }
        
        .modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            color: white;
            padding: 25px;
            border-radius: 20px;
            border: 3px solid #00ffff;
            z-index: 100;
            display: none;
            text-align: center;
            min-width: 280px;
            max-width: 90%;
            box-shadow: 0 0 50px rgba(0,255,255,0.5);
        }
        
        .modal h2 {
            color: #00ffff;
            margin-top: 0;
            font-size: 24px;
        }
        
        .modal input {
            padding: 12px;
            font-size: 20px;
            width: 90%;
            margin: 15px 0;
            border-radius: 10px;
            border: none;
            background: #333;
            color: white;
            -webkit-appearance: none;
        }
        
        .modal button {
            padding: 12px 30px;
            font-size: 20px;
            background: #00ffff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            color: black;
            font-weight: bold;
        }
        
        .modal .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 35px;
            cursor: pointer;
            color: #ff0000;
        }
        
        #controls-hint {
            display: none;
        }
        
        #damage-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,0,0,0);
            pointer-events: none;
            z-index: 15;
            transition: background 0.2s;
        }
    </style>
</head>
<body>
    <div id="rotate-warning">
        <svg viewBox="0 0 100 100" width="100" height="100">
            <rect x="20" y="30" width="60" height="40" rx="5" fill="none" stroke="white" stroke-width="3"/>
            <circle cx="50" cy="50" r="5" fill="white"/>
            <path d="M35 20 L50 5 L65 20" stroke="white" stroke-width="3" fill="none"/>
        </svg>
        <p>–ü–æ–≤–µ—Ä–Ω—ñ—Ç—å –ø—Ä–∏—Å—Ç—Ä—ñ–π<br>—É –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–µ –ø–æ–ª–æ–∂–µ–Ω–Ω—è</p>
    </div>

    <div id="info-panel">
        <div>‚ù§Ô∏è <span id="health" class="value">100</span></div>
        <div>‚≠ê <span id="score" class="value">0</span></div>
        <div>üî´ <span id="ammo" class="value">30</span></div>
        <div>üó∫Ô∏è <span id="level-display" class="value">1/3</span></div>
    </div>
    
    <div id="level-name">–ú–Ü–°–¨–ö–ê –ó–ê–ë–£–î–û–í–ê</div>
    <div id="crosshair"></div>
    
    <!-- –°–ø—Ä–æ—â–µ–Ω–µ —Å–µ–Ω—Å–æ—Ä–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è -->
    <div id="touch-zone-left">
        <span>‚Üê –†–£–• ‚Üí</span>
    </div>
    <div id="touch-zone-right">
        <span>‚Üê –û–ì–õ–Ø–î ‚Üí</span>
    </div>
    <div id="fire-button">üî´</div>
    <div id="interact-button">üëÜ</div>
    
    <div id="joystick-left">
        <div class="joystick-knob" id="left-knob"></div>
    </div>
    <div id="joystick-right">
        <div class="joystick-knob" id="right-knob"></div>
    </div>
    
    <div id="damage-overlay"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ -->
    <div id="task-modal" class="modal">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h2 id="modal-title">–¢–µ—Å—Ç–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è</h2>
        <p id="modal-question">2 + 2 = ?</p>
        <input type="number" id="modal-answer" placeholder="–í–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å" inputmode="numeric">
        <br>
        <button onclick="checkAnswer()">–í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏</button>
        <p id="modal-result" style="margin-top: 10px; color: #ffaa00;"></p>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.128.0/build/three.module.js"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'https://unpkg.com/three@0.128.0/examples/jsm/controls/PointerLockControls.js';

        // --- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å—Ü–µ–Ω–∏ (—è–∫ —É –ø–µ—Ä—à—ñ–π –≤–µ—Ä—Å—ñ—ó) ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);
        scene.fog = new THREE.Fog(0x87CEEB, 30, 100);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 5, 15); // –¢—Ä–æ—Ö–∏ –Ω–∏–∂—á–µ –¥–ª—è –∫—Ä–∞—â–æ–≥–æ –æ–≥–ª—è–¥—É

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // --- –û—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è ---
        const ambientLight = new THREE.AmbientLight(0x404060);
        scene.add(ambientLight);

        const sunLight = new THREE.DirectionalLight(0xffffff, 1);
        sunLight.position.set(50, 50, 50);
        sunLight.castShadow = true;
        sunLight.shadow.mapSize.width = 1024;
        sunLight.shadow.mapSize.height = 1024;
        const d = 50;
        sunLight.shadow.camera.left = -d;
        sunLight.shadow.camera.right = d;
        sunLight.shadow.camera.top = d;
        sunLight.shadow.camera.bottom = -d;
        scene.add(sunLight);

        // --- –ó–º—ñ–Ω–Ω—ñ —Å—Ç–∞–Ω—É –≥—Ä–∞–≤—Ü—è ---
        let player = {
            health: 100,
            score: 0,
            ammo: 30,
            level: 1,
            maxLevel: 3
        };

        // –ú–∞—Å–∏–≤–∏ –æ–±'—î–∫—Ç—ñ–≤
        const bullets = [];
        const enemies = [];
        
        // –°—Ç–∞–Ω —Å–µ–Ω—Å–æ—Ä–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è
        let leftTouchId = null;
        let rightTouchId = null;
        let leftStartPos = { x: 0, y: 0 };
        let rightStartPos = { x: 0, y: 0 };
        let leftCurrentPos = { x: 0, y: 0 };
        let rightCurrentPos = { x: 0, y: 0 };
        
        // –ù–∞–ø—Ä—è–º–æ–∫ —Ä—É—Ö—É
        const moveDirection = new THREE.Vector3(0, 0, 0);
        
        // –ï–ª–µ–º–µ–Ω—Ç–∏ UI
        const leftZone = document.getElementById('touch-zone-left');
        const rightZone = document.getElementById('touch-zone-right');
        const fireButton = document.getElementById('fire-button');
        const interactButton = document.getElementById('interact-button');
        const leftKnob = document.getElementById('left-knob');
        const rightKnob = document.getElementById('right-knob');
        const damageOverlay = document.getElementById('damage-overlay');

        // --- –°–µ–Ω—Å–æ—Ä–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è ---
        function handleTouchStart(e) {
            e.preventDefault();
            const touches = e.touches;
            
            for (let i = 0; i < touches.length; i++) {
                const touch = touches[i];
                const touchX = touch.clientX;
                const touchY = touch.clientY;
                
                // –õ—ñ–≤–∞ –∑–æ–Ω–∞ - —Ä—É—Ö
                if (touchX < window.innerWidth / 2) {
                    if (leftTouchId === null) {
                        leftTouchId = touch.identifier;
                        leftStartPos = { x: touchX, y: touchY };
                        leftCurrentPos = { x: touchX, y: touchY };
                    }
                } 
                // –ü—Ä–∞–≤–∞ –∑–æ–Ω–∞ - –æ–≥–ª—è–¥
                else {
                    if (rightTouchId === null) {
                        rightTouchId = touch.identifier;
                        rightStartPos = { x: touchX, y: touchY };
                        rightCurrentPos = { x: touchX, y: touchY };
                    }
                }
            }
        }
        
        function handleTouchMove(e) {
            e.preventDefault();
            const touches = e.touches;
            
            for (let i = 0; i < touches.length; i++) {
                const touch = touches[i];
                
                if (leftTouchId === touch.identifier) {
                    leftCurrentPos = { x: touch.clientX, y: touch.clientY };
                    
                    // –û–±—á–∏—Å–ª—é—î–º–æ –Ω–∞–ø—Ä—è–º–æ–∫ —Ä—É—Ö—É
                    const deltaX = (leftCurrentPos.x - leftStartPos.x) / 70;
                    const deltaY = (leftCurrentPos.y - leftStartPos.y) / 70;
                    
                    // –û–±–º–µ–∂—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è
                    moveDirection.x = Math.max(-1, Math.min(1, deltaX));
                    moveDirection.z = Math.max(-1, Math.min(1, -deltaY));
                    
                    // –†—É—Ö–∞—î–º–æ –¥–∂–æ–π—Å—Ç–∏–∫
                    const knobX = 45 + deltaX * 40;
                    const knobY = 45 + deltaY * 40;
                    leftKnob.style.transform = `translate(${knobX - 45}px, ${knobY - 45}px)`;
                }
                
                if (rightTouchId === touch.identifier) {
                    const newRightPos = { x: touch.clientX, y: touch.clientY };
                    
                    // –ü–æ–≤–æ—Ä–æ—Ç –∫–∞–º–µ—Ä–∏ (–ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ –¥–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ)
                    const deltaX = (newRightPos.x - rightCurrentPos.x) * 0.008;
                    const deltaY = (newRightPos.y - rightCurrentPos.y) * 0.008;
                    
                    camera.rotation.y -= deltaX;
                    camera.rotation.x -= deltaY;
                    camera.rotation.x = Math.max(-Math.PI/3, Math.min(Math.PI/3, camera.rotation.x));
                    
                    // –†—É—Ö–∞—î–º–æ –ø—Ä–∞–≤–∏–π –¥–∂–æ–π—Å—Ç–∏–∫
                    const rightDeltaX = (newRightPos.x - rightStartPos.x) / 70;
                    const rightDeltaY = (newRightPos.y - rightStartPos.y) / 70;
                    const rightKnobX = 45 + Math.max(-1, Math.min(1, rightDeltaX)) * 40;
                    const rightKnobY = 45 + Math.max(-1, Math.min(1, rightDeltaY)) * 40;
                    rightKnob.style.transform = `translate(${rightKnobX - 45}px, ${rightKnobY - 45}px)`;
                    
                    rightCurrentPos = newRightPos;
                }
            }
        }
        
        function handleTouchEnd(e) {
            e.preventDefault();
            
            leftTouchId = null;
            rightTouchId = null;
            moveDirection.set(0, 0, 0);
            
            // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –¥–∂–æ–π—Å—Ç–∏–∫–∏ –≤ —Ü–µ–Ω—Ç—Ä
            leftKnob.style.transform = 'translate(0px, 0px)';
            rightKnob.style.transform = 'translate(0px, 0px)';
        }
        
        // –°—Ç—Ä—ñ–ª—å–±–∞
        function handleFireTap(e) {
            e.preventDefault();
            
            if (player.ammo <= 0) {
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞
                player.ammo = 30;
                updateUI();
                return;
            }
            
            player.ammo--;
            updateUI();
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ –∫—É–ª—é
            const bulletGeo = new THREE.SphereGeometry(0.2);
            const bulletMat = new THREE.MeshStandardMaterial({ color: 0xffaa00 });
            const bullet = new THREE.Mesh(bulletGeo, bulletMat);
            
            bullet.position.copy(camera.position);
            bullet.castShadow = true;
            scene.add(bullet);
            
            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(camera.quaternion);
            
            bullets.push({
                mesh: bullet,
                direction: direction,
                speed: 0.8,
                distance: 0
            });
            
            // –õ–µ–≥–∫–∞ –≤—ñ–±—Ä–∞—Ü—ñ—è
            if (navigator.vibrate) navigator.vibrate(30);
        }
        
        // –í–∑–∞—î–º–æ–¥—ñ—è
        function handleInteractTap(e) {
            e.preventDefault();
            checkInteraction();
        }
        
        // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π
        document.addEventListener('touchstart', handleTouchStart, { passive: false });
        document.addEventListener('touchmove', handleTouchMove, { passive: false });
        document.addEventListener('touchend', handleTouchEnd, { passive: false });
        document.addEventListener('touchcancel', handleTouchEnd, { passive: false });
        
        fireButton.addEventListener('touchstart', handleFireTap, { passive: false });
        interactButton.addEventListener('touchstart', handleInteractTap, { passive: false });

        // --- –û–Ω–æ–≤–ª–µ–Ω–Ω—è UI ---
        function updateUI() {
            document.getElementById('health').textContent = player.health;
            document.getElementById('score').textContent = player.score;
            document.getElementById('ammo').textContent = player.ammo;
            document.getElementById('level-display').textContent = player.level + '/3';
            
            let levelName = '';
            switch(player.level) {
                case 1: levelName = '–ú–Ü–°–¨–ö–ê –ó–ê–ë–£–î–û–í–ê'; break;
                case 2: levelName = '–õ–Ü–°–û–í–ò–ô –ú–ê–°–ò–í'; break;
                case 3: levelName = '–ì–Ü–†–°–¨–ö–ê –ú–Ü–°–¶–ï–í–Ü–°–¢–¨'; break;
            }
            document.getElementById('level-name').textContent = levelName;
        }

        // --- –ü–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è –≥—Ä–∞–≤—Ü—è (–º'—è–∫—à–µ) ---
        function damagePlayer(amount) {
            player.health = Math.max(0, player.health - amount);
            updateUI();
            
            // –ß–µ—Ä–≤–æ–Ω–∏–π —Å–ø–∞–ª–∞—Ö
            damageOverlay.style.background = 'rgba(255,0,0,0.2)';
            setTimeout(() => {
                damageOverlay.style.background = 'rgba(255,0,0,0)';
            }, 150);
            
            if (player.health <= 0) {
                // –ú'—è–∫–µ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è
                player.health = 100;
                player.score = Math.max(0, player.score - 20);
                updateUI();
            }
        }

        // --- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä—ñ–≤–Ω—ñ–≤ (—è–∫ —É –ø–µ—Ä—à—ñ–π –≤–µ—Ä—Å—ñ—ó) ---
        function clearLevel() {
            const toRemove = [];
            scene.traverse(obj => {
                if (obj !== camera && 
                    obj !== sunLight && 
                    obj !== ambientLight &&
                    !(obj instanceof THREE.AmbientLight) &&
                    !(obj instanceof THREE.DirectionalLight)) {
                    toRemove.push(obj);
                }
            });
            toRemove.forEach(obj => scene.remove(obj));
            
            enemies.length = 0;
            bullets.length = 0;
        }

        function createGround(color) {
            const geometry = new THREE.CircleGeometry(100, 64);
            const material = new THREE.MeshStandardMaterial({ color: color });
            const ground = new THREE.Mesh(geometry, material);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = 0;
            ground.receiveShadow = true;
            scene.add(ground);
        }

        // –†—ñ–≤–µ–Ω—å 1: –ú—ñ—Å—Ç–æ (–ø—Ä–æ—Å—Ç—ñ –≤–æ—Ä–æ–≥–∏)
        function createCityLevel() {
            createGround(0x555555);
            
            // –ë—É–¥—ñ–≤–ª—ñ
            for (let i = 0; i < 15; i++) {
                const geometry = new THREE.BoxGeometry(2 + Math.random()*3, 2 + Math.random()*6, 2 + Math.random()*3);
                const material = new THREE.MeshStandardMaterial({ color: 0x888888 });
                const building = new THREE.Mesh(geometry, material);
                building.position.set((Math.random() - 0.5) * 50, geometry.parameters.height/2, (Math.random() - 0.5) * 50);
                building.castShadow = true;
                building.receiveShadow = true;
                scene.add(building);
            }
            
            // –ü—Ä–æ—Å—Ç—ñ –≤–æ—Ä–æ–≥–∏ (–Ω–µ —Å—Ç—Ä—ñ–ª—è—é—Ç—å)
            for (let i = 0; i < 4; i++) {
                const enemyGeo = new THREE.BoxGeometry(1, 2, 1);
                const enemyMat = new THREE.MeshStandardMaterial({ color: 0xff3333 });
                const enemy = new THREE.Mesh(enemyGeo, enemyMat);
                
                enemy.position.set((Math.random() - 0.5) * 40, 1, (Math.random() - 0.5) * 40);
                enemy.castShadow = true;
                enemy.receiveShadow = true;
                scene.add(enemy);
                
                enemies.push({
                    mesh: enemy,
                    speed: 0.02,
                    direction: new THREE.Vector3(Math.random() - 0.5, 0, Math.random() - 0.5).normalize(),
                    health: 2
                });
            }
        }

        // –†—ñ–≤–µ–Ω—å 2: –î–∂—É–Ω–≥–ª—ñ
        function createJungleLevel() {
            createGround(0x2e8b57);
            
            // –î–µ—Ä–µ–≤–∞
            for (let i = 0; i < 25; i++) {
                const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.5, 3), new THREE.MeshStandardMaterial({ color: 0x8b4513 }));
                trunk.position.set((Math.random() - 0.5) * 60, 1.5, (Math.random() - 0.5) * 60);
                trunk.castShadow = true;
                trunk.receiveShadow = true;
                scene.add(trunk);
                
                const leaves = new THREE.Mesh(new THREE.ConeGeometry(1, 2), new THREE.MeshStandardMaterial({ color: 0x228b22 }));
                leaves.position.copy(trunk.position);
                leaves.position.y += 2.5;
                leaves.castShadow = true;
                leaves.receiveShadow = true;
                scene.add(leaves);
            }
            
            // –í–æ—Ä–æ–≥–∏
            for (let i = 0; i < 5; i++) {
                const enemyGeo = new THREE.SphereGeometry(1);
                const enemyMat = new THREE.MeshStandardMaterial({ color: 0x00aa00 });
                const enemy = new THREE.Mesh(enemyGeo, enemyMat);
                
                enemy.position.set((Math.random() - 0.5) * 50, 1, (Math.random() - 0.5) * 50);
                enemy.castShadow = true;
                enemy.receiveShadow = true;
                scene.add(enemy);
                
                enemies.push({
                    mesh: enemy,
                    speed: 0.015,
                    direction: new THREE.Vector3(Math.random() - 0.5, 0, Math.random() - 0.5).normalize(),
                    health: 1
                });
            }
        }

        // –†—ñ–≤–µ–Ω—å 3: –ì–æ—Ä–∏
        function createMountainsLevel() {
            createGround(0x8B5A2B);
            
            // –ì–æ—Ä–∏
            for (let i = 0; i < 10; i++) {
                const mountain = new THREE.Mesh(new THREE.ConeGeometry(2 + Math.random()*4, 4 + Math.random()*6), 
                    new THREE.MeshStandardMaterial({ color: 0x808080 }));
                mountain.position.set((Math.random() - 0.5) * 60, 0, (Math.random() - 0.5) * 60);
                mountain.castShadow = true;
                mountain.receiveShadow = true;
                scene.add(mountain);
            }
            
            // –í–æ—Ä–æ–≥–∏
            for (let i = 0; i < 4; i++) {
                const enemyGeo = new THREE.ConeGeometry(1, 2);
                const enemyMat = new THREE.MeshStandardMaterial({ color: 0xcccccc });
                const enemy = new THREE.Mesh(enemyGeo, enemyMat);
                
                enemy.position.set((Math.random() - 0.5) * 50, 1, (Math.random() - 0.5) * 50);
                enemy.castShadow = true;
                enemy.receiveShadow = true;
                scene.add(enemy);
                
                enemies.push({
                    mesh: enemy,
                    speed: 0.01,
                    direction: new THREE.Vector3(Math.random() - 0.5, 0, Math.random() - 0.5).normalize(),
                    health: 2
                });
            }
        }

        // --- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ ---
        let currentTaskId = 0;
        let activeTrigger = null;

        window.closeModal = function() {
            document.getElementById('task-modal').style.display = 'none';
        };

        window.checkAnswer = function() {
            const answer = document.getElementById('modal-answer').value.trim();
            const resultEl = document.getElementById('modal-result');
            
            const correctAnswers = ['4', '5', '6', '8', '12', '7', '10'];
            const isCorrect = (answer === correctAnswers[currentTaskId]);
            
            if (isCorrect) {
                resultEl.style.color = '#00ff00';
                resultEl.textContent = '–ü—Ä–∞–≤–∏–ª—å–Ω–æ! +10 –±–∞–ª—ñ–≤';
                player.score += 10;
                updateUI();
                
                if (activeTrigger) {
                    scene.remove(activeTrigger);
                    activeTrigger = null;
                }
                
                setTimeout(closeModal, 1000);
            } else {
                resultEl.style.color = '#ff0000';
                resultEl.textContent = '–°–ø—Ä–æ–±—É–π—Ç–µ —â–µ!';
            }
        };

        function checkInteraction() {
            const triggers = [];
            scene.traverse(obj => {
                if (obj.userData && obj.userData.type === 'task') {
                    if (obj.position.distanceTo(camera.position) < 5) {
                        triggers.push(obj);
                    }
                }
            });
            
            if (triggers.length > 0) {
                activeTrigger = triggers[0];
                currentTaskId = activeTrigger.userData.taskId;
                
                document.getElementById('task-modal').style.display = 'block';
                document.getElementById('modal-answer').value = '';
                document.getElementById('modal-result').textContent = '';
            }
        }

        // --- –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä—ñ–≤ ---
        function addTriggers() {
            const triggerMat = new THREE.MeshBasicMaterial({ color: 0x00ff00, wireframe: true, transparent: true, opacity: 0.2 });
            
            for (let i = 0; i < 3; i++) {
                const triggerGeo = new THREE.BoxGeometry(3, 3, 3);
                const trigger = new THREE.Mesh(triggerGeo, triggerMat);
                trigger.position.set(10 + i*12, 1.5, 10 + i*5);
                scene.add(trigger);
                trigger.userData = { type: 'task', taskId: i };
            }
        }

        // --- –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–µ—Ä—à–æ–≥–æ —Ä—ñ–≤–Ω—è ---
        createCityLevel();
        addTriggers();

        // --- –ê–Ω—ñ–º–∞—Ü—ñ—è (—Å–ø—Ä–æ—â–µ–Ω–∞) ---
        function animate() {
            requestAnimationFrame(animate);

            // –†—É—Ö –≥—Ä–∞–≤—Ü—è –≤—ñ–¥ –¥–∂–æ–π—Å—Ç–∏–∫–∞
            if (moveDirection.length() > 0.1) {
                const speed = 0.12;
                const move = new THREE.Vector3(moveDirection.x, 0, moveDirection.z);
                move.applyQuaternion(camera.quaternion);
                move.y = 0;
                move.normalize();
                
                camera.position.add(move.multiplyScalar(speed));
            }

            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É–ª—å
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                bullet.mesh.position.add(bullet.direction.clone().multiplyScalar(bullet.speed));
                bullet.distance += bullet.speed;
                
                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–Ω—è —É –≤–æ—Ä–æ–≥—ñ–≤
                for (let j = enemies.length - 1; j >= 0; j--) {
                    const enemy = enemies[j];
                    if (bullet.mesh.position.distanceTo(enemy.mesh.position) < 1.5) {
                        enemy.health--;
                        scene.remove(bullet.mesh);
                        bullets.splice(i, 1);
                        
                        if (enemy.health <= 0) {
                            scene.remove(enemy.mesh);
                            enemies.splice(j, 1);
                            player.score += 10;
                            updateUI();
                        }
                        break;
                    }
                }
                
                if (bullet.distance > 50) {
                    scene.remove(bullet.mesh);
                    bullets.splice(i, 1);
                }
            }

            // –†—É—Ö –≤–æ—Ä–æ–≥—ñ–≤
            enemies.forEach(enemy => {
                enemy.mesh.position.add(enemy.direction.clone().multiplyScalar(enemy.speed));
                
                // –í—ñ–¥–±–∏–≤–∞–Ω–Ω—è –≤—ñ–¥ –º–µ–∂
                if (Math.abs(enemy.mesh.position.x) > 45) enemy.direction.x *= -1;
                if (Math.abs(enemy.mesh.position.z) > 45) enemy.direction.z *= -1;
                
                // –í–∏–ø–∞–¥–∫–æ–≤–µ –ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è –ø—Ä–∏ –∑—ñ—Ç–∫–Ω–µ–Ω–Ω—ñ (–¥—É–∂–µ —Ä—ñ–¥–∫–æ)
                if (Math.random() < 0.001 && enemy.mesh.position.distanceTo(camera.position) < 2) {
                    damagePlayer(5);
                }
            });

            renderer.render(scene, camera);
        }

        animate();

        // –ê–¥–∞–ø—Ç–∞—Ü—ñ—è –¥–æ –∑–º—ñ–Ω–∏ —Ä–æ–∑–º—ñ—Ä—É
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // –ü–æ—á–∞—Ç–∫–æ–≤–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è UI
        updateUI();

        // –î–æ–¥–∞—î–º–æ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ñ –∑—ñ—Ä–∫–∏
        const starsGeo = new THREE.BufferGeometry();
        const starsPos = new Float32Array(200 * 3);
        for (let i = 0; i < 200 * 3; i += 3) {
            starsPos[i] = (Math.random() - 0.5) * 200;
            starsPos[i+1] = (Math.random() - 0.5) * 200;
            starsPos[i+2] = (Math.random() - 0.5) * 200;
        }
        starsGeo.setAttribute('position', new THREE.BufferAttribute(starsPos, 3));
        const starsMat = new THREE.PointsMaterial({ color: 0xffffff, size: 0.2 });
        const stars = new THREE.Points(starsGeo, starsMat);
        scene.add(stars);

        console.log('–ú–æ–±—ñ–ª—å–Ω–∞ –≤–µ—Ä—Å—ñ—è (–ø—Ä–æ—Å—Ç–∞) –∑–∞–ø—É—â–µ–Ω–∞!');
    </script>
</body>
</html>
